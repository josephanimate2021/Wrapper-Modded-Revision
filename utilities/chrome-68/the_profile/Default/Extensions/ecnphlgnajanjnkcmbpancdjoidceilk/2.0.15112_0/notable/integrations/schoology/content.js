function injectScript(e,t){var n=document.getElementsByTagName(t)[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",e),n.appendChild(s)}function injectStyle(e,t){var n=document.getElementsByTagName(t)[0],s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href",e),n.appendChild(s)}function getTitle(){let e=document.querySelector(".gen-post-link");return e?e.innerText.trim():""}function editAfterAssignmentCreated(e){if(getTitle()===e.assignment_name.trim()){document.querySelector(".folder-contents-cell .action-edit a").click()}}if(document.querySelector('link[href="/sites/all/themes/schoology_theme/print.css"]')||document.querySelector('link[href="/sites/all/themes/schoology_theme/favicon.ico"]')||window.location.origin.match(/^https?:\/\/\S+.schoology.com$/)){injectScript(chrome.extension.getURL("notable/integrations/schoology/page_script.js"),"head"),injectStyle(chrome.extension.getURL("notable/integrations/schoology/styles.css"),"head");try{chrome.storage.sync.get("notable.user",(function(e){var t=e["notable.user"],n=document.getElementsByTagName("head")[0],s=document.createElement("meta");s.setAttribute("id","kamidata"),s.setAttribute("data-kami-user-id",t.id),n.appendChild(s)}))}catch(e){}window.addEventListener("message",(function(e){"kami-assignment-create"===e.data.event_name&&sessionStorage.setItem("kami-assignment-created",JSON.stringify(e.data))}));let e=sessionStorage.getItem("kami-assignment-created");if(e){sessionStorage.removeItem("kami-assignment-created");try{let t=JSON.parse(e);t.timestamp&&t.timestamp>Date.now()-5e3&&editAfterAssignmentCreated(t)}catch(e){console.log("Error from content script: ",e)}}}if(document.querySelector('link[href="https://asset-cdn.schoology.com/sites/all/modules/schoology_core/s_course/s_course_unified_ui.css"')){const e=window.location.origin,t="https://web.kamihq.com",n=()=>document.location.pathname.match(/^\/assignment\/([0-9]+)/);chrome.runtime.onMessage.addListener((function(s){if(n()){const i=n()[1];if(s.file_link){const n=s.file_link,a=s.filename,r=document.querySelector("._17Z60").innerText,c=n.match(/\/attachment\/([0-9]+)\/source/);if(!c)return;const m=c[1];var o={schoology:{assignment_id:i,assignment_name:r,attachment_id:m,schoology_origin:e}};const l="schoology-"+i+"-attachment-"+m,d=new URL(n),g=new URL(`${t}/web/viewer.html`);g.searchParams.set("file",d.toString()),g.searchParams.set("individual_copy_key",l),g.searchParams.set("source","schoology"),g.searchParams.set("integration_data",JSON.stringify(o)),g.searchParams.set("filename",a),g.searchParams.set("referer",document.location.href),window.open(g.toString(),"_blank")}else s.redirectUrl&&window.location.replace(s.redirectUrl)}}))}